"use strict";(()=>{var e={};e.id=181,e.ids=[181],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4939:e=>{e.exports=require("papaparse")},6302:e=>{e.exports=require("xlsx")},6705:e=>{e.exports=import("formidable")},6555:e=>{e.exports=import("uuid")},7147:e=>{e.exports=require("fs")},6398:(e,t,s)=>{s.a(e,async(e,i)=>{try{s.r(t),s.d(t,{config:()=>d,default:()=>p,routeModule:()=>u});var a=s(1802),r=s(7153),o=s(6249),l=s(3872),n=e([l]);l=(n.then?(await n)():n)[0];let p=(0,o.l)(l,"default"),d=(0,o.l)(l,"config"),u=new a.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/file-upload",pathname:"/api/file-upload",bundlePath:"",filename:""},userland:l});i()}catch(e){i(e)}})},4217:(e,t,s)=>{s.d(t,{O:()=>o});let i=require("@supabase/supabase-js"),a="https://rpudkaqdoguytyweytww.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwdWRrYXFkb2d1eXR5d2V5dHd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNDI3NTMsImV4cCI6MjA2MzcxODc1M30.GWu-jUQXMU94kTuGx9aK5aG_xNVjJFq9lbrcLUW8HBA";if(!a||!r)throw Error("Missing Supabase environment variables");let o=(0,i.createClient)(a,r,{auth:{persistSession:!1,autoRefreshToken:!1},global:{fetch:fetch}})},3872:(e,t,s)=>{s.a(e,async(e,i)=>{try{s.r(t),s.d(t,{config:()=>c,default:()=>handler});var a=s(6705),r=s(7147),o=s(6302),l=s(4939),n=s.n(l),p=s(6555),d=s(4217),u=e([a,p]);[a,p]=u.then?(await u)():u;let c={api:{bodyParser:!1}};async function handler(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let s;let i=new a.IncomingForm({multiples:!0,keepExtensions:!0}),[l,u]=await new Promise((t,s)=>{i.parse(e,(e,i,a)=>{if(e)return s(e);t([i,a])})});if(!u.file)return t.status(400).json({message:"No files uploaded"});let c=Array.isArray(u.file)?u.file[0]:u.file,f=l.instanceId?l.instanceId[0]:null,m=l.stepId?l.stepId[0]:null,h=c.filepath,_=c.originalFilename||"unknown",w=_.split(".").pop()?.toLowerCase(),I=await r.promises.readFile(h);if("csv"===w){let e=I.toString();s=n().parse(e,{header:!0}).data}else{if("xlsx"!==w&&"xls"!==w)return t.status(400).json({message:"Unsupported file type"});let e=o.read(I),i=e.Sheets[e.SheetNames[0]];s=o.utils.sheet_to_json(i)}if(f&&m){let e=(0,p.v4)(),t=new Date().toISOString(),{error:i}=await d.O.from("file_uploads").insert({id:e,instance_id:f,step_id:m,file_name:_,file_type:w,file_size:c.size,uploaded_at:t});if(i)throw i;let{error:a}=await d.O.from("step_executions").insert({instance_id:f,step_id:m,started_at:t,completed_at:t,status:"completed",output:JSON.stringify({fileName:_,fileType:w,fileSize:c.size,rows:s.length,uploadId:e}),input_data:{}});if(a)throw a}return t.status(200).json({message:"File uploaded and processed successfully",fileName:_,fileType:w,fileSize:c.size,rowCount:s.length,data:s})}catch(e){return console.error("Error processing file upload:",e),t.status(500).json({message:"Failed to process file upload"})}}i()}catch(e){i(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[222],()=>__webpack_exec__(6398));module.exports=s})();