"use strict";(()=>{var e={};e.id=181,e.ids=[181],e.modules={1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4939:e=>{e.exports=require("papaparse")},6302:e=>{e.exports=require("xlsx")},6705:e=>{e.exports=import("formidable")},6555:e=>{e.exports=import("uuid")},7147:e=>{e.exports=require("fs")},6398:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{config:()=>p,default:()=>u,routeModule:()=>d});var i=s(1802),r=s(7153),o=s(6249),n=s(3872),l=e([n]);n=(l.then?(await l)():l)[0];let u=(0,o.l)(n,"default"),p=(0,o.l)(n,"config"),d=new i.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/file-upload",pathname:"/api/file-upload",bundlePath:"",filename:""},userland:n});a()}catch(e){a(e)}})},4217:(e,t,s)=>{s.d(t,{O:()=>o});let a=require("@supabase/supabase-js"),i="https://rpudkaqdoguytyweytww.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwdWRrYXFkb2d1eXR5d2V5dHd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNDI3NTMsImV4cCI6MjA2MzcxODc1M30.GWu-jUQXMU94kTuGx9aK5aG_xNVjJFq9lbrcLUW8HBA";if(!i||!r)throw Error("Missing Supabase environment variables");let o=(0,a.createClient)(i,r,{auth:{persistSession:!1,autoRefreshToken:!1},global:{fetch:fetch}})},3872:(e,t,s)=>{s.a(e,async(e,a)=>{try{s.r(t),s.d(t,{config:()=>f,default:()=>handler});var i=s(6705),r=s(7147),o=s(6302),n=s(4939),l=s.n(n),u=s(1649),p=s(6555),d=s(4217),c=e([i,p]);[i,p]=c.then?(await c)():c;let f={api:{bodyParser:!1}};async function handler(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});let s=await (0,u.getSession)({req:e});if(!s)return t.status(401).json({message:"Unauthorized"});try{let s;let a=new i.IncomingForm({multiples:!0,keepExtensions:!0}),[n,u]=await new Promise((t,s)=>{a.parse(e,(e,a,i)=>{if(e)return s(e);t([a,i])})});if(!u.file)return t.status(400).json({message:"No files uploaded"});let c=Array.isArray(u.file)?u.file[0]:u.file,f=n.instanceId?n.instanceId[0]:null,m=n.stepId?n.stepId[0]:null,h=c.filepath,w=c.originalFilename||"unknown",_=w.split(".").pop()?.toLowerCase(),g=await r.promises.readFile(h);if("csv"===_){let e=g.toString();s=l().parse(e,{header:!0}).data}else{if("xlsx"!==_&&"xls"!==_)return t.status(400).json({message:"Unsupported file type"});let e=o.read(g),a=e.Sheets[e.SheetNames[0]];s=o.utils.sheet_to_json(a)}if(f&&m){let e=(0,p.v4)(),t=new Date().toISOString(),{error:a}=await d.O.from("file_uploads").insert({id:e,instance_id:f,step_id:m,file_name:w,file_type:_,file_size:c.size,uploaded_at:t});if(a)throw a;let{error:i}=await d.O.from("step_executions").insert({instance_id:f,step_id:m,started_at:t,completed_at:t,status:"completed",output:JSON.stringify({fileName:w,fileType:_,fileSize:c.size,rows:s.length,uploadId:e}),input_data:{}});if(i)throw i}return t.status(200).json({message:"File uploaded and processed successfully",fileName:w,fileType:_,fileSize:c.size,rowCount:s.length,data:s})}catch(e){return console.error("Error processing file upload:",e),t.status(500).json({message:"Failed to process file upload"})}}a()}catch(e){a(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[222],()=>__webpack_exec__(6398));module.exports=s})();