"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6555:e=>{e.exports=import("uuid")},2053:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{config:()=>w,default:()=>d,routeModule:()=>u});var s=t(1802),a=t(7153),i=t(6249),l=t(612),n=e([l]);l=(n.then?(await n)():n)[0];let d=(0,i.l)(l,"default"),w=(0,i.l)(l,"config"),u=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/workflows/[id]",pathname:"/api/workflows/[id]",bundlePath:"",filename:""},userland:l});o()}catch(e){o(e)}})},9492:(e,r,t)=>{t.d(r,{O:()=>i});var o=t(2885);let s="https://rpudkaqdoguytyweytww.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwdWRrYXFkb2d1eXR5d2V5dHd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNDI3NTMsImV4cCI6MjA2MzcxODc1M30.GWu-jUQXMU94kTuGx9aK5aG_xNVjJFq9lbrcLUW8HBA";if(!s||!a)throw Error("Missing Supabase environment variables");let i=(0,o.createClient)(s,a)},612:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{default:()=>handler});var s=t(9492),a=t(1649),i=t(6555),l=e([i]);async function handler(e,r){let{id:t}=e.query,o=await (0,a.getSession)({req:e});if(!o)return r.status(401).json({message:"Unauthorized"});if("GET"===e.method)try{let{data:e,error:o}=await s.O.from("workflows").select(`
          *,
          steps:workflow_steps(*)
        `).eq("id",t).single();if(o){if("PGRST116"===o.code)return r.status(404).json({message:"Workflow not found"});throw o}return r.status(200).json(e)}catch(e){return console.error("Error fetching workflow:",e),r.status(500).json({message:"Failed to fetch workflow"})}if("PUT"===e.method)try{let{title:o,description:a,steps:l,version:n,versionNotes:d}=e.body;if(!o||!a||!l||!Array.isArray(l))return r.status(400).json({message:"Invalid workflow data"});let w=new Date().toISOString(),{error:u}=await s.O.from("workflows").update({title:o,description:a,updated_at:w,version:n||"1.0",version_notes:d||""}).eq("id",t);if(u)throw u;let{error:f}=await s.O.from("workflow_steps").delete().eq("workflow_id",t);if(f)throw f;let p=l.map((e,r)=>({id:(0,i.v4)(),workflow_id:t,order_index:r,type:e.type,label:e.label,system_prompt:e.systemPrompt||void 0,user_prompt:e.userPrompt||void 0,instructions:e.instructions||void 0,created_at:w,updated_at:w})),{error:c}=await s.O.from("workflow_steps").insert(p);if(c)throw c;let{data:m,error:k}=await s.O.from("workflows").select(`
          *,
          steps:workflow_steps(*)
        `).eq("id",t).single();if(k)throw k;return r.status(200).json(m)}catch(e){return console.error("Error updating workflow:",e),r.status(500).json({message:"Failed to update workflow"})}if("DELETE"===e.method)try{let{error:e}=await s.O.from("workflow_steps").delete().eq("workflow_id",t);if(e)throw e;let{error:o}=await s.O.from("workflows").delete().eq("id",t);if(o)throw o;return r.status(200).json({message:"Workflow deleted successfully"})}catch(e){return console.error("Error deleting workflow:",e),r.status(500).json({message:"Failed to delete workflow"})}return r.status(405).json({message:"Method not allowed"})}i=(l.then?(await l)():l)[0],o()}catch(e){o(e)}})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[222],()=>__webpack_exec__(2053));module.exports=t})();