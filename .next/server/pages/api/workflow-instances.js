"use strict";(()=>{var e={};e.id=408,e.ids=[408],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},1649:e=>{e.exports=require("next-auth/react")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6555:e=>{e.exports=import("uuid")},1044:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>w,routeModule:()=>u});var a=r(1802),o=r(7153),i=r(6249),n=r(5282),l=e([n]);n=(l.then?(await l)():l)[0];let w=(0,i.l)(n,"default"),c=(0,i.l)(n,"config"),u=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/workflow-instances",pathname:"/api/workflow-instances",bundlePath:"",filename:""},userland:n});s()}catch(e){s(e)}})},9492:(e,t,r)=>{r.d(t,{O:()=>i});var s=r(2885);let a="https://rpudkaqdoguytyweytww.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwdWRrYXFkb2d1eXR5d2V5dHd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNDI3NTMsImV4cCI6MjA2MzcxODc1M30.GWu-jUQXMU94kTuGx9aK5aG_xNVjJFq9lbrcLUW8HBA";if(!a||!o)throw Error("Missing Supabase environment variables");let i=(0,s.createClient)(a,o)},5282:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>handler});var a=r(9492),o=r(1649),i=r(6555),n=e([i]);async function handler(e,t){let r=await (0,o.getSession)({req:e});if(!r)return t.status(401).json({message:"Unauthorized"});if("GET"===e.method)try{let{data:e,error:r}=await a.O.from("workflow_instances").select(`
          *,
          workflow:workflows(*)
        `).order("started_at",{ascending:!1});if(r)throw r;return t.status(200).json(e)}catch(e){return console.error("Error fetching workflow instances:",e),t.status(500).json({message:"Failed to fetch workflow instances"})}if("POST"===e.method)try{let{workflowId:s,clientId:o,clientName:n}=e.body;if(!s)return t.status(400).json({message:"Workflow ID is required"});let{data:l,error:w}=await a.O.from("workflows").select(`
          *,
          steps:workflow_steps(*)
        `).eq("id",s).single();if(w)return t.status(404).json({message:"Workflow not found"});let c=(0,i.v4)(),u=new Date().toISOString(),{error:d}=await a.O.from("workflow_instances").insert({id:c,workflow_id:s,started_by:r.user.id,started_at:u,status:"in_progress",current_step_index:0,client_id:o||null,client_name:n||null,total_execution_time_ms:0,human_time_spent_ms:0,ai_processing_time_ms:0,client_wait_time_ms:0,total_cost:0});if(d)throw d;let{data:f,error:_}=await a.O.from("workflow_instances").select(`
          *,
          workflow:workflows(
            *,
            steps:workflow_steps(*)
          )
        `).eq("id",c).single();if(_)throw _;return t.status(201).json(f)}catch(e){return console.error("Error creating workflow instance:",e),t.status(500).json({message:"Failed to create workflow instance"})}return t.status(405).json({message:"Method not allowed"})}i=(n.then?(await n)():n)[0],s()}catch(e){s(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[222],()=>__webpack_exec__(1044));module.exports=r})();