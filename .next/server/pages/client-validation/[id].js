(()=>{var e={};e.id=604,e.ids=[604,888,660],e.modules={1465:(e,s,t)=>{"use strict";t.r(s),t.d(s,{config:()=>I,default:()=>S,getServerSideProps:()=>P,getStaticPaths:()=>k,getStaticProps:()=>_,reportWebVitals:()=>C,routeModule:()=>D,unstable_getServerProps:()=>T,unstable_getServerSideProps:()=>U,unstable_getStaticParams:()=>q,unstable_getStaticPaths:()=>F,unstable_getStaticProps:()=>E});var a={};t.r(a),t.d(a,{default:()=>_id_,getServerSideProps:()=>getServerSideProps});var l=t(7093),i=t(5244),r=t(1323),n=t(9209),d=t.n(n),c=t(5913),o=t(997),m=t(6689),x=t(968),p=t.n(x),u=t(8387);let h=(0,u.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),f=(0,u.Z)("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]);var g=t(9735),j=t(6345),y=t(1203),v=t(2885);let N="https://rpudkaqdoguytyweytww.supabase.co",w="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwdWRrYXFkb2d1eXR5d2V5dHd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNDI3NTMsImV4cCI6MjA2MzcxODc1M30.GWu-jUQXMU94kTuGx9aK5aG_xNVjJFq9lbrcLUW8HBA";if(!N||!w)throw Error("Missing Supabase environment variables");let b=(0,v.createClient)(N,w),getServerSideProps=async e=>{let{id:s}=e.params;try{let{data:e,error:t}=await b.from("client_validations").select(`
        *,
        instance:workflow_instances(
          *,
          workflow:workflows(*)
        )
      `).eq("id",s).single();if(t)return{props:{validation:null,error:"Client validation not found"}};return{props:{validation:e}}}catch(e){return console.error("Error fetching client validation:",e),{props:{validation:null,error:"Failed to load client validation"}}}},_id_=({validation:e,error:s})=>{let[t,a]=(0,m.useState)([]),[l,i]=(0,m.useState)(!1),[r,n]=(0,m.useState)(""),[d,c]=(0,m.useState)(!1),x=e&&("expired"===e.status||new Date(e.expires_at)<new Date),u=e&&"completed"===e.status,removeFile=e=>{a(t.filter((s,t)=>t!==e))},handleSubmit=async s=>{if(s.preventDefault(),e){if(0===t.length){n("Please select at least one file to upload");return}i(!0),n("");try{let s=new FormData;t.forEach(e=>{s.append("file",e)});let a=await Promise.all(t.map(async s=>{let t=new FormData;t.append("file",s),t.append("instanceId",e.instance_id),t.append("stepId",e.step_id);let a=await fetch("/api/file-upload",{method:"POST",body:t});if(!a.ok)throw Error(`Failed to upload ${s.name}`);return s.name})),l=await fetch(`/api/client-validations/${e.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:a})});if(!l.ok){let e=await l.json();throw Error(e.message||"Failed to complete validation")}c(!0)}catch(e){console.error("Error submitting validation:",e),n(e instanceof Error?e.message:"An unknown error occurred")}finally{i(!1)}}};return s?(0,o.jsxs)("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[o.jsx(p(),{children:o.jsx("title",{children:"Error | Client Upload"})}),o.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:o.jsx("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:o.jsx("div",{className:"rounded-md bg-red-50 p-4",children:(0,o.jsxs)("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(h,{className:"h-5 w-5 text-red-400"})}),(0,o.jsxs)("div",{className:"ml-3",children:[o.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),o.jsx("p",{className:"mt-2 text-sm text-red-700",children:s})]})]})})})})]}):e?(0,o.jsxs)("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[o.jsx(p(),{children:(0,o.jsxs)("title",{children:["Client Upload | ",e.instance.workflow.title]})}),(0,o.jsxs)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[o.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Secure Upload Portal"}),o.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:e.instance.workflow.title})]}),o.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:o.jsx("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:x?o.jsx("div",{className:"rounded-md bg-yellow-50 p-4",children:(0,o.jsxs)("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(h,{className:"h-5 w-5 text-yellow-400"})}),(0,o.jsxs)("div",{className:"ml-3",children:[o.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"This upload link has expired"}),o.jsx("p",{className:"mt-2 text-sm text-yellow-700",children:"Please contact the person who sent you this link for assistance."})]})]})}):u?o.jsx("div",{className:"rounded-md bg-green-50 p-4",children:(0,o.jsxs)("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(f,{className:"h-5 w-5 text-green-400"})}),(0,o.jsxs)("div",{className:"ml-3",children:[o.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Upload completed"}),o.jsx("p",{className:"mt-2 text-sm text-green-700",children:"Thank you for providing the requested files. You may close this page."})]})]})}):d?o.jsx("div",{className:"rounded-md bg-green-50 p-4",children:(0,o.jsxs)("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(f,{className:"h-5 w-5 text-green-400"})}),(0,o.jsxs)("div",{className:"ml-3",children:[o.jsx("h3",{className:"text-sm font-medium text-green-800",children:"Files uploaded successfully"}),o.jsx("p",{className:"mt-2 text-sm text-green-700",children:"Thank you for providing the requested files. You may close this page."})]})]})}):(0,o.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-6",children:[(0,o.jsxs)("div",{children:[o.jsx("p",{className:"text-sm text-gray-700 mb-4",children:e.instance.workflow.description}),o.jsx("p",{className:"text-sm text-gray-700 mb-4",children:"Please upload any relevant documents that will help us understand your processes better. This could include organization charts, process documentation, time studies, or other materials."}),(0,o.jsxs)("p",{className:"text-xs text-gray-500 mb-6",children:["This secure link will expire on ",new Date(e.expires_at).toLocaleDateString(),"."]})]}),(0,o.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-md p-6 flex flex-col items-center",children:[o.jsx(g.Z,{className:"h-8 w-8 text-gray-400"}),o.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Upload files"}),o.jsx("input",{type:"file",multiple:!0,onChange:e=>{e.target.files&&(a(Array.from(e.target.files)),n(""))},className:"mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"})]}),t.length>0&&(0,o.jsxs)("div",{children:[o.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Selected Files:"}),o.jsx("ul",{className:"mt-2 divide-y divide-gray-200",children:t.map((e,s)=>(0,o.jsxs)("li",{className:"py-2 flex justify-between items-center",children:[(0,o.jsxs)("div",{className:"flex items-center",children:[o.jsx(j.Z,{className:"h-5 w-5 text-gray-400 mr-2"}),o.jsx("span",{className:"text-sm text-gray-700",children:e.name}),(0,o.jsxs)("span",{className:"ml-2 text-xs text-gray-500",children:["(",(e.size/1024).toFixed(0)," KB)"]})]}),o.jsx("button",{type:"button",onClick:()=>removeFile(s),className:"text-gray-400 hover:text-gray-500",children:o.jsx(y.Z,{className:"h-5 w-5"})})]},s))})]}),r&&o.jsx("div",{className:"rounded-md bg-red-50 p-4",children:(0,o.jsxs)("div",{className:"flex",children:[o.jsx("div",{className:"flex-shrink-0",children:o.jsx(h,{className:"h-5 w-5 text-red-400"})}),o.jsx("div",{className:"ml-3",children:o.jsx("p",{className:"text-sm text-red-700",children:r})})]})}),o.jsx("button",{type:"submit",disabled:l||0===t.length,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:l?"Uploading...":"Upload Files"})]})})})]}):(0,o.jsxs)("div",{className:"min-h-screen bg-gray-100 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[o.jsx(p(),{children:o.jsx("title",{children:"Loading | Client Upload"})}),o.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:o.jsx("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:o.jsx("p",{className:"text-center text-sm text-gray-500",children:"Loading..."})})})]})},S=(0,r.l)(a,"default"),_=(0,r.l)(a,"getStaticProps"),k=(0,r.l)(a,"getStaticPaths"),P=(0,r.l)(a,"getServerSideProps"),I=(0,r.l)(a,"config"),C=(0,r.l)(a,"reportWebVitals"),E=(0,r.l)(a,"unstable_getStaticProps"),F=(0,r.l)(a,"unstable_getStaticPaths"),q=(0,r.l)(a,"unstable_getStaticParams"),T=(0,r.l)(a,"unstable_getServerProps"),U=(0,r.l)(a,"unstable_getServerSideProps"),D=new l.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/client-validation/[id]",pathname:"/client-validation/[id]",bundlePath:"",filename:""},components:{App:c.default,Document:d()},userland:a})},5913:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var a=t(997);t(6764);var l=t(1649);let __WEBPACK_DEFAULT_EXPORT__=function({Component:e,pageProps:{session:s,...t}}){return a.jsx(l.SessionProvider,{session:s,children:a.jsx(e,{...t})})}},6764:()=>{},2885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},1017:e=>{"use strict";e.exports=require("path")}};var s=require("../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[209,450,387,555],()=>__webpack_exec__(1465));module.exports=t})();